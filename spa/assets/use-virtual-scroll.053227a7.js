import{a7 as ve,r as q,a as j,w as ce,K as me,h as A,A as pe,aJ as we,B as he,C as ze,o as ye,q as ge}from"./index.3dea5965.js";let X=!1;{const e=document.createElement("div"),n=document.createElement("div");e.setAttribute("dir","rtl"),e.style.width="1px",e.style.height="1px",e.style.overflow="auto",n.style.width="1000px",n.style.height="1px",document.body.appendChild(e),e.appendChild(n),e.scrollLeft=-1e3,X=e.scrollLeft>=0,e.remove()}const M=1e3,Me=["start","center","end","start-force","center-force","end-force"],ae=Array.prototype.filter,Ee=window.getComputedStyle(document.body).overflowAnchor===void 0?ve:function(e,n){e!==null&&(cancelAnimationFrame(e._qOverflowAnimationFrame),e._qOverflowAnimationFrame=requestAnimationFrame(()=>{if(e===null)return;const S=e.children||[];ae.call(S,y=>y.dataset&&y.dataset.qVsAnchor!==void 0).forEach(y=>{delete y.dataset.qVsAnchor});const u=S[n];u&&u.dataset&&(u.dataset.qVsAnchor="")}))};function T(e,n){return e+n}function Z(e,n,S,u,y,s,x,E){const h=e===window?document.scrollingElement||document.documentElement:e,g=y===!0?"offsetWidth":"offsetHeight",o={scrollStart:0,scrollViewSize:-x-E,scrollMaxSize:0,offsetStart:-x,offsetEnd:-E};if(y===!0?(e===window?(o.scrollStart=window.pageXOffset||window.scrollX||document.body.scrollLeft||0,o.scrollViewSize+=document.documentElement.clientWidth):(o.scrollStart=h.scrollLeft,o.scrollViewSize+=h.clientWidth),o.scrollMaxSize=h.scrollWidth,s===!0&&(o.scrollStart=(X===!0?o.scrollMaxSize-o.scrollViewSize:0)-o.scrollStart)):(e===window?(o.scrollStart=window.pageYOffset||window.scrollY||document.body.scrollTop||0,o.scrollViewSize+=document.documentElement.clientHeight):(o.scrollStart=h.scrollTop,o.scrollViewSize+=h.clientHeight),o.scrollMaxSize=h.scrollHeight),S!==null)for(let v=S.previousElementSibling;v!==null;v=v.previousElementSibling)v.classList.contains("q-virtual-scroll--skip")===!1&&(o.offsetStart+=v[g]);if(u!==null)for(let v=u.nextElementSibling;v!==null;v=v.nextElementSibling)v.classList.contains("q-virtual-scroll--skip")===!1&&(o.offsetEnd+=v[g]);if(n!==e){const v=h.getBoundingClientRect(),p=n.getBoundingClientRect();y===!0?(o.offsetStart+=p.left-v.left,o.offsetEnd-=p.width):(o.offsetStart+=p.top-v.top,o.offsetEnd-=p.height),e!==window&&(o.offsetStart+=o.scrollStart),o.offsetEnd+=o.scrollMaxSize-o.offsetStart}return o}function ne(e,n,S,u){n==="end"&&(n=(e===window?document.body:e)[S===!0?"scrollWidth":"scrollHeight"]),e===window?S===!0?(u===!0&&(n=(X===!0?document.body.scrollWidth-document.documentElement.clientWidth:0)-n),window.scrollTo(n,window.pageYOffset||window.scrollY||document.body.scrollTop||0)):window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,n):S===!0?(u===!0&&(n=(X===!0?e.scrollWidth-e.offsetWidth:0)-n),e.scrollLeft=n):e.scrollTop=n}function C(e,n,S,u){if(S>=u)return 0;const y=n.length,s=Math.floor(S/M),x=Math.floor((u-1)/M)+1;let E=e.slice(s,x).reduce(T,0);return S%M!==0&&(E-=n.slice(s*M,S).reduce(T,0)),u%M!==0&&u!==y&&(E-=n.slice(u,x*M).reduce(T,0)),E}const be={virtualScrollSliceSize:{type:[Number,String],default:null},virtualScrollSliceRatioBefore:{type:[Number,String],default:1},virtualScrollSliceRatioAfter:{type:[Number,String],default:1},virtualScrollItemSize:{type:[Number,String],default:24},virtualScrollStickySizeStart:{type:[Number,String],default:0},virtualScrollStickySizeEnd:{type:[Number,String],default:0},tableColspan:[Number,String]},xe={virtualScrollHorizontal:Boolean,onVirtualScroll:Function,...be};function Ve({virtualScrollLength:e,getVirtualScrollTarget:n,getVirtualScrollEl:S,virtualScrollItemSizeComputed:u}){const y=ge(),{props:s,emit:x,proxy:E}=y,{$q:h}=E;let g,o,v,p=[],f;const V=q(0),k=q(0),F=q({}),O=q(null),_=q(null),B=q(null),m=q({from:0,to:0}),D=j(()=>s.tableColspan!==void 0?s.tableColspan:100);u===void 0&&(u=j(()=>s.virtualScrollItemSize));const I=j(()=>u.value+";"+s.virtualScrollHorizontal),se=j(()=>I.value+";"+s.virtualScrollSliceRatioBefore+";"+s.virtualScrollSliceRatioAfter);ce(se,()=>{H()}),ce(I,Y);function Y(){K(o,!0)}function ee(l){K(l===void 0?o:l)}function W(l,t){const r=n();if(r==null||r.nodeType===8)return;const d=Z(r,S(),O.value,_.value,s.virtualScrollHorizontal,h.lang.rtl,s.virtualScrollStickySizeStart,s.virtualScrollStickySizeEnd);v!==d.scrollViewSize&&H(d.scrollViewSize),N(r,d,Math.min(e.value-1,Math.max(0,parseInt(l,10)||0)),0,Me.indexOf(t)>-1?t:o>-1&&l>o?"end":"start")}function ue(){const l=n();if(l==null||l.nodeType===8)return;const t=Z(l,S(),O.value,_.value,s.virtualScrollHorizontal,h.lang.rtl,s.virtualScrollStickySizeStart,s.virtualScrollStickySizeEnd),r=e.value-1,d=t.scrollMaxSize-t.offsetStart-t.offsetEnd-k.value;if(g===t.scrollStart)return;if(t.scrollMaxSize<=0){N(l,t,0,0);return}v!==t.scrollViewSize&&H(t.scrollViewSize),J(m.value.from);const w=Math.floor(t.scrollMaxSize-Math.max(t.scrollViewSize,t.offsetEnd)-Math.min(f[r],t.scrollViewSize/2));if(w>0&&Math.ceil(t.scrollStart)>=w){N(l,t,r,t.scrollMaxSize-t.offsetEnd-p.reduce(T,0));return}let a=0,c=t.scrollStart-t.offsetStart,z=c;if(c<=d&&c+t.scrollViewSize>=V.value)c-=V.value,a=m.value.from,z=c;else for(let i=0;c>=p[i]&&a<r;i++)c-=p[i],a+=M;for(;c>0&&a<r;)c-=f[a],c>-t.scrollViewSize?(a++,z=c):z=f[a]+c;N(l,t,a,z)}function N(l,t,r,d,w){const a=typeof w=="string"&&w.indexOf("-force")>-1,c=a===!0?w.replace("-force",""):w,z=c!==void 0?c:"start";let i=Math.max(0,r-F.value[z]),b=i+F.value.total;b>e.value&&(b=e.value,i=Math.max(0,b-F.value.total)),g=t.scrollStart;const L=i!==m.value.from||b!==m.value.to;if(L===!1&&c===void 0){te(r);return}const{activeElement:re}=document,R=B.value;L===!0&&R!==null&&R!==re&&R.contains(re)===!0&&(R.addEventListener("focusout",le),setTimeout(()=>{R!==null&&R.removeEventListener("focusout",le)})),Ee(R,r-i);const de=c!==void 0?f.slice(i,r).reduce(T,0):0;if(L===!0){const P=b>=m.value.from&&i<=m.value.to?m.value.to:b;m.value={from:i,to:P},V.value=C(p,f,0,i),k.value=C(p,f,b,e.value),requestAnimationFrame(()=>{m.value.to!==b&&g===t.scrollStart&&(m.value={from:m.value.from,to:b},k.value=C(p,f,b,e.value))})}requestAnimationFrame(()=>{if(g!==t.scrollStart)return;L===!0&&J(i);const P=f.slice(i,r).reduce(T,0),$=P+t.offsetStart+V.value,ie=$+f[r];let G=$+d;if(c!==void 0){const Se=P-de,Q=t.scrollStart+Se;G=a!==!0&&Q<$&&ie<Q+t.scrollViewSize?Q:c==="end"?ie-t.scrollViewSize:$-(c==="start"?0:Math.round((t.scrollViewSize-f[r])/2))}g=G,ne(l,G,s.virtualScrollHorizontal,h.lang.rtl),te(r)})}function J(l){const t=B.value;if(t){const r=ae.call(t.children,i=>i.classList&&i.classList.contains("q-virtual-scroll--skip")===!1),d=r.length,w=s.virtualScrollHorizontal===!0?i=>i.getBoundingClientRect().width:i=>i.offsetHeight;let a=l,c,z;for(let i=0;i<d;){for(c=w(r[i]),i++;i<d&&r[i].classList.contains("q-virtual-scroll--with-prev")===!0;)c+=w(r[i]),i++;z=c-f[a],z!==0&&(f[a]+=z,p[Math.floor(a/M)]+=z),a++}}}function le(){B.value!==null&&B.value!==void 0&&B.value.focus()}function K(l,t){const r=1*u.value;(t===!0||Array.isArray(f)===!1)&&(f=[]);const d=f.length;f.length=e.value;for(let a=e.value-1;a>=d;a--)f[a]=r;const w=Math.floor((e.value-1)/M);p=[];for(let a=0;a<=w;a++){let c=0;const z=Math.min((a+1)*M,e.value);for(let i=a*M;i<z;i++)c+=f[i];p.push(c)}o=-1,g=void 0,V.value=C(p,f,0,m.value.from),k.value=C(p,f,m.value.to,e.value),l>=0?(J(m.value.from),me(()=>{W(l)})):U()}function H(l){if(l===void 0&&typeof window!="undefined"){const c=n();c!=null&&c.nodeType!==8&&(l=Z(c,S(),O.value,_.value,s.virtualScrollHorizontal,h.lang.rtl,s.virtualScrollStickySizeStart,s.virtualScrollStickySizeEnd).scrollViewSize)}v=l;const t=parseFloat(s.virtualScrollSliceRatioBefore)||0,r=parseFloat(s.virtualScrollSliceRatioAfter)||0,d=1+t+r,w=l===void 0||l<=0?1:Math.ceil(l/u.value),a=Math.max(1,w,Math.ceil((s.virtualScrollSliceSize>0?s.virtualScrollSliceSize:10)/d));F.value={total:Math.ceil(a*d),start:Math.ceil(a*t),center:Math.ceil(a*(.5+t)),end:Math.ceil(a*(1+t)),view:w}}function fe(l,t){const r=s.virtualScrollHorizontal===!0?"width":"height",d={["--q-virtual-scroll-item-"+r]:u.value+"px"};return[l==="tbody"?A(l,{class:"q-virtual-scroll__padding",key:"before",ref:O},[A("tr",[A("td",{style:{[r]:`${V.value}px`,...d},colspan:D.value})])]):A(l,{class:"q-virtual-scroll__padding",key:"before",ref:O,style:{[r]:`${V.value}px`,...d}}),A(l,{class:"q-virtual-scroll__content",key:"content",ref:B,tabindex:-1},t.flat()),l==="tbody"?A(l,{class:"q-virtual-scroll__padding",key:"after",ref:_},[A("tr",[A("td",{style:{[r]:`${k.value}px`,...d},colspan:D.value})])]):A(l,{class:"q-virtual-scroll__padding",key:"after",ref:_,style:{[r]:`${k.value}px`,...d}})]}function te(l){o!==l&&(s.onVirtualScroll!==void 0&&x("virtual-scroll",{index:l,from:m.value.from,to:m.value.to-1,direction:l<o?"decrease":"increase",ref:E}),o=l)}H();const U=pe(ue,h.platform.is.ios===!0?120:35);we(()=>{H()});let oe=!1;return he(()=>{oe=!0}),ze(()=>{if(oe!==!0)return;const l=n();g!==void 0&&l!==void 0&&l!==null&&l.nodeType!==8?ne(l,g,s.virtualScrollHorizontal,h.lang.rtl):W(o)}),ye(()=>{U.cancel()}),Object.assign(E,{scrollTo:W,reset:Y,refresh:ee}),{virtualScrollSliceRange:m,virtualScrollSliceSizeComputed:F,setVirtualScrollSize:H,onVirtualScrollEvt:U,localResetVirtualScroll:K,padVirtualScroll:fe,scrollTo:W,reset:Y,refresh:ee}}export{Ve as a,xe as u};
